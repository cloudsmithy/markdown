## **4. æ„å»ºç¬¬ä¸€ä¸ª RESTful API**

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ **Flask-RESTful** æ‰©å±•åº“æ¥æ„å»ºä¸€ä¸ªç¬¦åˆ RESTful é£æ ¼çš„ APIã€‚æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å®šä¹‰èµ„æºç±»ã€å¤„ç†ä¸åŒçš„ HTTP è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETEï¼‰ï¼Œä»¥åŠå¦‚ä½•è¿”å› JSON æ•°æ®ã€‚

---

### **4.1 ä½¿ç”¨ Flask-RESTful**

#### **4.1.1 ä»€ä¹ˆæ˜¯ Flask-RESTfulï¼Ÿ**
Flask-RESTful æ˜¯ä¸€ä¸ª Flask æ‰©å±•åº“ï¼Œä¸“é—¨ç”¨äºå¿«é€Ÿæ„å»º RESTful APIã€‚å®ƒæä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼š
- **èµ„æºç±»**ï¼šå°† API ç«¯ç‚¹å°è£…ä¸ºç±»ï¼Œæ¯ä¸ªç±»å¯¹åº”ä¸€ä¸ªèµ„æºã€‚
- **è¯·æ±‚è§£æ**ï¼šç®€åŒ–è¯·æ±‚æ•°æ®çš„è§£æå’ŒéªŒè¯ã€‚
- **å“åº”æ ¼å¼åŒ–**ï¼šè‡ªåŠ¨å°† Python å¯¹è±¡è½¬æ¢ä¸º JSON æ ¼å¼ã€‚

#### **4.1.2 å®‰è£… Flask-RESTful**
å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£… Flask-RESTfulï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š
```bash
pip install Flask-RESTful
```

#### **4.1.3 åˆå§‹åŒ– Flask-RESTful**
åœ¨ `app.py` ä¸­åˆå§‹åŒ– Flask-RESTfulï¼š
```python
from flask import Flask
from flask_restful import Api, Resource

# åˆ›å»º Flask åº”ç”¨å®ä¾‹
app = Flask(__name__)

# åˆ›å»º Api å®ä¾‹
api = Api(app)

# å®šä¹‰èµ„æºç±»
class HelloWorld(Resource):
    def get(self):
        return {'message': 'Hello, World!'}

# æ·»åŠ èµ„æºç±»åˆ° Api
api.add_resource(HelloWorld, '/')

# å¯åŠ¨åº”ç”¨
if __name__ == '__main__':
    app.run(debug=True)
```

è¿è¡Œåº”ç”¨åï¼Œè®¿é—® `http://127.0.0.1:5000/`ï¼Œä½ ä¼šçœ‹åˆ°è¿”å›çš„ JSON æ•°æ®ï¼š
```json
{
    "message": "Hello, World!"
}
```

---

### **4.2 å®šä¹‰èµ„æºç±»**

#### **4.2.1 ä»€ä¹ˆæ˜¯èµ„æºç±»ï¼Ÿ**
èµ„æºç±»æ˜¯ Flask-RESTful çš„æ ¸å¿ƒæ¦‚å¿µã€‚æ¯ä¸ªèµ„æºç±»å¯¹åº”ä¸€ä¸ª API ç«¯ç‚¹ï¼Œå¹¶å®šä¹‰äº†å¯¹è¯¥èµ„æºçš„æ“ä½œï¼ˆå¦‚ GETã€POSTã€PUTã€DELETEï¼‰ã€‚

#### **4.2.2 å®šä¹‰èµ„æºç±»çš„æ­¥éª¤**
1. ç»§æ‰¿ `Resource` ç±»ã€‚
2. å®ç° HTTP æ–¹æ³•ï¼ˆå¦‚ `get`ã€`post`ã€`put`ã€`delete`ï¼‰ã€‚
3. å°†èµ„æºç±»æ·»åŠ åˆ° `Api` å®ä¾‹ä¸­ã€‚

#### **4.2.3 ç¤ºä¾‹ï¼šç”¨æˆ·èµ„æºç±»**
ä»¥ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·èµ„æºç±»çš„ç¤ºä¾‹ï¼š
```python
from flask_restful import Resource

class UserResource(Resource):
    def get(self, user_id=None):
        if user_id:
            return {'user_id': user_id, 'name': 'Alice'}
        else:
            return {'users': [{'id': 1, 'name': 'Alice'}, {'id': 2, 'name': 'Bob'}]}

    def post(self):
        return {'message': 'User created'}, 201

    def put(self, user_id):
        return {'message': f'User {user_id} updated'}

    def delete(self, user_id):
        return {'message': f'User {user_id} deleted'}
```

#### **4.2.4 æ·»åŠ èµ„æºç±»åˆ° Api**
å°†èµ„æºç±»æ·»åŠ åˆ° `Api` å®ä¾‹ä¸­ï¼Œå¹¶æŒ‡å®š URL è·¯å¾„ï¼š
```python
api.add_resource(UserResource, '/users', '/users/<int:user_id>')
```

- `/users`ï¼šè·å–æ‰€æœ‰ç”¨æˆ·æˆ–åˆ›å»ºæ–°ç”¨æˆ·ã€‚
- `/users/<int:user_id>`ï¼šè·å–ã€æ›´æ–°æˆ–åˆ é™¤æŒ‡å®šç”¨æˆ·ã€‚

---

### **4.3 å¤„ç† GETã€POSTã€PUTã€DELETE è¯·æ±‚**

#### **4.3.1 GET è¯·æ±‚**
- **è·å–èµ„æºåˆ—è¡¨**ï¼š
  ```python
  def get(self):
      return {'users': [{'id': 1, 'name': 'Alice'}, {'id': 2, 'name': 'Bob'}]}
  ```

- **è·å–å•ä¸ªèµ„æº**ï¼š
  ```python
  def get(self, user_id):
      return {'user_id': user_id, 'name': 'Alice'}
  ```

#### **4.3.2 POST è¯·æ±‚**
- **åˆ›å»ºèµ„æº**ï¼š
  ```python
  def post(self):
      return {'message': 'User created'}, 201
  ```

#### **4.3.3 PUT è¯·æ±‚**
- **æ›´æ–°èµ„æº**ï¼š
  ```python
  def put(self, user_id):
      return {'message': f'User {user_id} updated'}
  ```

#### **4.3.4 DELETE è¯·æ±‚**
- **åˆ é™¤èµ„æº**ï¼š
  ```python
  def delete(self, user_id):
      return {'message': f'User {user_id} deleted'}
  ```

---

### **4.4 è¿”å› JSON æ•°æ®**

#### **4.4.1 è‡ªåŠ¨è½¬æ¢ä¸º JSON**
Flask-RESTful ä¼šè‡ªåŠ¨å°† Python å­—å…¸è½¬æ¢ä¸º JSON æ ¼å¼ã€‚ä¾‹å¦‚ï¼š
```python
def get(self):
    return {'message': 'Hello, World!'}
```
è¿”å›çš„ JSON æ•°æ®ï¼š
```json
{
    "message": "Hello, World!"
}
```

#### **4.4.2 è‡ªå®šä¹‰çŠ¶æ€ç **
å¯ä»¥é€šè¿‡è¿”å›å…ƒç»„æ¥æŒ‡å®šçŠ¶æ€ç ï¼š
```python
def post(self):
    return {'message': 'User created'}, 201
```
è¿”å›çš„ JSON æ•°æ®å’ŒçŠ¶æ€ç ï¼š
```json
{
    "message": "User created"
}
```
çŠ¶æ€ç ï¼š`201 Created`

#### **4.4.3 è¿”å›åˆ—è¡¨**
å¯ä»¥ç›´æ¥è¿”å›åˆ—è¡¨ï¼ŒFlask-RESTful ä¼šå°†å…¶è½¬æ¢ä¸º JSON æ•°ç»„ï¼š
```python
def get(self):
    return [{'id': 1, 'name': 'Alice'}, {'id': 2, 'name': 'Bob'}]
```
è¿”å›çš„ JSON æ•°æ®ï¼š
```json
[
    {
        "id": 1,
        "name": "Alice"
    },
    {
        "id": 2,
        "name": "Bob"
    }
]
```

---

## **å®Œæ•´ç¤ºä¾‹**

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Flask-RESTful API ç¤ºä¾‹ï¼š
```python
from flask import Flask
from flask_restful import Api, Resource

app = Flask(__name__)
api = Api(app)

class UserResource(Resource):
    def get(self, user_id=None):
        if user_id:
            return {'user_id': user_id, 'name': 'Alice'}
        else:
            return {'users': [{'id': 1, 'name': 'Alice'}, {'id': 2, 'name': 'Bob'}]}

    def post(self):
        return {'message': 'User created'}, 201

    def put(self, user_id):
        return {'message': f'User {user_id} updated'}

    def delete(self, user_id):
        return {'message': f'User {user_id} deleted'}

api.add_resource(UserResource, '/users', '/users/<int:user_id>')

if __name__ == '__main__':
    app.run(debug=True)
```

---

## **æ€»ç»“**
é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œä½ å·²ç»æŒæ¡äº†ä»¥ä¸‹å†…å®¹ï¼š
1. å¦‚ä½•ä½¿ç”¨ Flask-RESTful æ„å»º RESTful APIã€‚
2. å¦‚ä½•å®šä¹‰èµ„æºç±»å¹¶å¤„ç† GETã€POSTã€PUTã€DELETE è¯·æ±‚ã€‚
3. å¦‚ä½•è¿”å› JSON æ•°æ®ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿›å…¥ **5. æ•°æ®éªŒè¯ä¸åºåˆ—åŒ–**ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨ Marshmallow è¿›è¡Œæ•°æ®éªŒè¯å’Œåºåˆ—åŒ–ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œæˆ–è€…éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šå’Œä»£ç ç¤ºä¾‹ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼ ğŸ˜„